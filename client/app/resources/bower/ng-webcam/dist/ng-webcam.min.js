!function(){"use strict";function n(){function n(n,e){return['<div class="ng-webcam no-overlay" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.webcamLive === true && vm.config.countdown > 0 && vm.counter > 0" id="ng-webcam-counter">{{vm.counter}}</span>','<img ng-show="vm.webcamLive === true" id="ng-webcam-overlay" src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},window.localStorage&&window.localStorage.setItem("visited","1"),angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY291bnRkb3duIiwiY29uZmlndXJlTGlzdGVuZXJzIiwiY29uZmlndXJlIiwid2ViY2FtTGl2ZSIsIldlYmNhbSIsInJlc2V0Iiwid2ViY2FtTG9hZGVkIiwiaXNEZWZpbmVkIiwic25hcHNob3RUaW1lciIsImNhbmNlbCIsInVuZGVmaW5lZCIsImNvdW50ZG93blRpbWVyIiwiY291bnRlciIsInNodXR0ZXJVcmwiLCJzb3VuZCIsIkF1ZGlvIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsInNyYyIsInNwbGl0Iiwic2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0X3dpZHRoIiwiZGVzdF9oZWlnaHQiLCJmb3JjZV9mbGFzaCIsImltYWdlX2Zvcm1hdCIsImpwZWdfcXVhbGl0eSIsImZsaXBfaG9yaXoiLCJmbGFzaE5vdERldGVjdGVkVGV4dCIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImF0dGFjaCIsIm9uIiwiJGFwcGx5Iiwib25Mb2FkIiwib25MaXZlIiwiZXJyIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsaUhBQ0EsbUlBQ0EsOEZBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLE9BQUFDLGNBQUFELE9BQUFDLGFBQUFDLFFBQUEsVUFBQSxLQUNBQyxRQUFBQyxZQUFBTixFQUFBQyxPQUFBTSxlQUFBUCxFQUFBQyxPQUFBTSxZQUFBLFFBQ0FGLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFPLGdCQUFBUixFQUFBQyxPQUFBTyxhQUFBLFFBQ0FILFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFRLGVBQUFULEVBQUFDLE9BQUFRLFlBQUEsS0FDQUosUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVMsZ0JBQUFWLEVBQUFDLE9BQUFTLGFBQUEsS0FDQUwsUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVUsU0FBQVgsRUFBQUMsT0FBQVUsTUFBQSxHQUNBTixRQUFBQyxZQUFBTixFQUFBQyxPQUFBVyxTQUFBWixFQUFBQyxPQUFBVyxNQUFBLEdBQ0FQLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFZLGFBQUFiLEVBQUFDLE9BQUFZLFVBQUEsR0FDQUMsSUFDQUMsSUFHQSxRQUFBbkIsS0FDQUksRUFBQWdCLFlBQUFDLE9BQUFDLFFBQ0FsQixFQUFBZ0IsWUFBQSxFQUNB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K0IsR0FBQU4sRUFBQUcsRUFEQXhCLEVBQUFxRSxLQUVBVixJQUNBM0QsR0FBQW1CLGNBQUEsRUFDQW5CLEVBQUFnQixZQUFBLEVBQ0FoQixFQUFBeUIsUUFBQSxFQUNBekIsRUFBQU4sS0FBQUEsRUFDQU0sRUFBQUosUUFBQUEsRUFXQUUsRUFBQUgsSUFBQSxtQkFBQXNFLEdBV0FuRSxFQUFBSCxJQUFBLGNBQUF3RSxHQVdBckUsRUFBQUgsSUFBQSxlQUFBeUUsR0E1RUEsR0FBQUUsSUFDQUMsU0FBQSxJQUNBcEYsU0FBQUEsRUFDQUksS0FBQUEsRUFDQWlGLGtCQUFBLEVBQ0FDLFdBQUE1RSxFQUNBNkUsYUFBQSxLQUNBbEYsT0FDQVMsT0FBQSxJQUNBK0Qsa0JBQUEsSUFDQVgsUUFBQSxJQUNBSCxPQUFBLElBQ0FVLGtCQUFBLElBQ0FULE9BQUEsS0F5TUEsT0F0TEF0RCxHQUFBOEUsU0FBQSxTQUFBLGFBc0xBTCxFQTVPQWpFLFFBQUF1RSxPQUFBLGdCQUFBTixVQUFBLFdBQUFwRixHQUNBQSxFQUFBeUYiLCJmaWxlIjoibmctd2ViY2FtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ25nLXdlYmNhbScsIFtdKS5kaXJlY3RpdmUoJ25nV2ViY2FtJywgbmdXZWJjYW0pO1xyXG4gIG5nV2ViY2FtLiRpbmplY3QgPSBbXTtcclxuICAvKipcclxuICAgKiAgQG5nZG9jIERpcmVjdGl2ZVxyXG4gICAqICBAbmFtZSBuZy13ZWJjYW1cclxuICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICpcclxuICAgKiAgRGlyZWN0aXZlIGZvciBjYXB0dXJpbmcgaW1hZ2VzIGZyb20geW91ciBjb21wdXRlcidzIGNhbWVyYSwgYW5kIGRlbGl2ZXJ5IHRoZW4gdG8geW91IGFzIGRhdGEgdXJpXHJcbiAgICpcclxuICAgKiAgQHVzYWdlXHJcbiAgICogIGBgYGh0bWxcclxuICAgKiAgPG5nLXdlYmNhbVxyXG4gICAqICAgIGNvbmZpZz1cInZtLmNvbmZpZ1wiXHJcbiAgICogICAgb24tZXJyb3I9XCJ2bS5vbkVycm9yKGVycilcIlxyXG4gICAqICAgIG9uLWxvYWQ9XCJ2bS5vbkxvYWQoKVwiXHJcbiAgICogICAgb24tbGl2ZT1cInZtLm9uTGl2ZSgpXCJcclxuICAgKiAgICBvbi1jYXB0dXJlLXByb2dyZXNzPVwidm0ub25DYXB0dXJlUHJvZ3Jlc3Moc3JjLCBwcm9ncmVzcylcIlxyXG4gICAqICAgIG9uLWNhcHR1cmUtY29tcGxldGU9XCJ2bS5vbkNhcHR1cmVDb21wbGV0ZShzcmMpXCI+XHJcbiAgICogIDwvbmctd2ViY2FtPlxyXG4gICAqICBgYGBcclxuICAgKi9cclxuICBmdW5jdGlvbiBuZ1dlYmNhbSgpIHtcclxuICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZSxcclxuICAgICAgbGluazogbGluayxcclxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcclxuICAgICAgY29udHJvbGxlcjogbmdXZWJjYW1Db250cm9sbGVyLFxyXG4gICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgY29uZmlnOiAnPScsXHJcbiAgICAgICAgb25DYXB0dXJlQ29tcGxldGU6ICcmJyxcclxuICAgICAgICBvbkVycm9yOiAnJicsXHJcbiAgICAgICAgb25Mb2FkOiAnJicsXHJcbiAgICAgICAgb25DYXB0dXJlUHJvZ3Jlc3M6ICcmJyxcclxuICAgICAgICBvbkxpdmU6ICcmJ1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHRlbXBsYXRlKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgIHJldHVybiBbJzxkaXYgY2xhc3M9XCJuZy13ZWJjYW0gbm8tb3ZlcmxheVwiIG5nLWNsYXNzPVwie1xcJ25vLW92ZXJsYXlcXCcgOiB2bS5jb3VudGVyID09PSAwIHx8IHZtLmNvbmZpZy5jb3VudGRvd24gPT09IDB9XCI+JyxcclxuICAgICAgICAnPHNwYW4gbmctc2hvdz1cInZtLndlYmNhbUxpdmUgPT09IHRydWUgJiYgdm0uY29uZmlnLmNvdW50ZG93biA+IDAgJiYgdm0uY291bnRlciA+IDBcIiBpZD1cIm5nLXdlYmNhbS1jb3VudGVyXCI+e3t2bS5jb3VudGVyfX08L3NwYW4+JyxcclxuICAgICAgICAnPGltZyBuZy1zaG93PVwidm0ud2ViY2FtTGl2ZSA9PT0gdHJ1ZVwiIGlkPVwibmctd2ViY2FtLW92ZXJsYXlcIiBzcmM9XCJ7e3ZtLmNvbmZpZy5vdmVybGF5fX1cIiAvPicsXHJcbiAgICAgICAgJzxkaXYgaWQ9XCJuZy13ZWJjYW0tY29udGFpbmVyXCI+PC9kaXY+JyxcclxuICAgICAgICAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgY3RybC5pbml0KCk7XHJcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjdHJsLmRlc3Ryb3koKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdXZWJjYW1Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaW50ZXJ2YWwnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBuZ1dlYmNhbUNvbnRyb2xsZXIoJHNjb3BlLCAkaW50ZXJ2YWwpIHtcclxuICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXHJcbiAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgIHZhciBzb3VuZCwgc25hcHNob3RUaW1lciwgY291bnRkb3duVGltZXI7XHJcbiAgICAgIHZhciBpbWFnZXMgPSBbXTtcclxuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcclxuICAgICAgdm0uY291bnRlciA9IDM7XHJcbiAgICAgIHZtLmluaXQgPSBpbml0O1xyXG4gICAgICB2bS5kZXN0cm95ID0gZGVzdHJveTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICogIEBuYW1lIG5nV2ViY2FtX2NhcHR1cmVcclxuICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhcHR1cmUgdXNlciBhY3Rpb25cclxuICAgICAgICpcclxuICAgICAgICogIEB1c2FnZVxyXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9jYXB0dXJlJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxyXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXHJcbiAgICAgICAqL1xyXG4gICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vbicsIG9uV2ViY2FtT24pO1xyXG4gICAgICAvKipcclxuICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb2ZmXHJcbiAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogIExpc3RlbmVyIGZvciBjYW1lcmEgb2ZmIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb2ZmJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fb2ZmJywgb25XZWJjYW1PZmYpO1xyXG5cclxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICB2bS5jb25maWcgPSB2bS5jb25maWcgfHwge307XHJcbiAgICAgICAgaWYod2luZG93LmxvY2FsU3RvcmFnZSkgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCd2aXNpdGVkJywgJzEnKTtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy52aWV3ZXJXaWR0aCkpIHZtLmNvbmZpZy52aWV3ZXJXaWR0aCA9ICdhdXRvJztcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQpKSB2bS5jb25maWcudmlld2VySGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dFdpZHRoKSkgdm0uY29uZmlnLm91dHB1dFdpZHRoID0gMzIwO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dEhlaWdodCkpIHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQgPSAyNDA7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuZGVsYXkpKSB2bS5jb25maWcuZGVsYXkgPSAwO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnNob3RzKSkgdm0uY29uZmlnLnNob3RzID0gMTtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5jb3VudGRvd24pKSB2bS5jb25maWcuY291bnRkb3duID0gMDtcclxuICAgICAgICBjb25maWd1cmVMaXN0ZW5lcnMoKTtcclxuICAgICAgICBjb25maWd1cmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gZGVzdHJveSgpIHtcclxuICAgICAgICBpZih2bS53ZWJjYW1MaXZlKSBXZWJjYW0ucmVzZXQoKTtcclxuICAgICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XHJcbiAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoc25hcHNob3RUaW1lcikpIHtcclxuICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoc25hcHNob3RUaW1lcik7XHJcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZChjb3VudGRvd25UaW1lcikpIHtcclxuICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY291bnRkb3duVGltZXIpO1xyXG4gICAgICAgICAgY291bnRkb3duVGltZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmNvdW50ZXIgPSAzO1xyXG5cclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlKCkge1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5zaHV0dGVyVXJsKSkge1xyXG4gICAgICAgICAgc291bmQgPSBuZXcgQXVkaW8oKTtcclxuICAgICAgICAgIHNvdW5kLmF1dG9wbGF5ID0gZmFsc2U7XHJcbiAgICAgICAgICBpZihuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9GaXJlZm94LykpIHtcclxuICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmwuc3BsaXQoJy4nKVswXSArICcub2dnJztcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uc2V0KHtcclxuICAgICAgICAgIHdpZHRoOiB2bS5jb25maWcudmlld2VyV2lkdGgsXHJcbiAgICAgICAgICBoZWlnaHQ6IHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQsXHJcbiAgICAgICAgICBkZXN0X3dpZHRoOiB2bS5jb25maWcub3V0cHV0V2lkdGgsXHJcbiAgICAgICAgICBkZXN0X2hlaWdodDogdm0uY29uZmlnLm91dHB1dEhlaWdodCxcclxuICAgICAgICAgIGZvcmNlX2ZsYXNoOiBmYWxzZSxcclxuICAgICAgICAgIGltYWdlX2Zvcm1hdDogJ2pwZWcnLFxyXG4gICAgICAgICAganBlZ19xdWFsaXR5OiAxMDAsXHJcbiAgICAgICAgICBmbGlwX2hvcml6OiB0cnVlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KSkge1xyXG4gICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCkpIHtcclxuICAgICAgICAgIFdlYmNhbS5zZXRTV0ZMb2NhdGlvbih2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFdlYmNhbS5hdHRhY2goJyNuZy13ZWJjYW0tY29udGFpbmVyJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZUxpc3RlbmVycygpIHtcclxuICAgICAgICBXZWJjYW0ub24oJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uTG9hZCkpIHtcclxuICAgICAgICAgICAgICB2bS5vbkxvYWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgV2ViY2FtLm9uKCdsaXZlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS53ZWJjYW1MaXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25MaXZlKSkge1xyXG4gICAgICAgICAgICAgIHZtLm9uTGl2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBXZWJjYW0ub24oJ2Vycm9yJywgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkVycm9yKSkge1xyXG4gICAgICAgICAgICB2bS5vbkVycm9yKHtlcnI6ZXJyfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNhcHR1cmUoaW5kZXgpIHtcclxuICAgICAgICBpZihzb3VuZCkge1xyXG4gICAgICAgICAgc291bmQucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSkge1xyXG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChzbmFwc2hvdFRpbWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24oZGF0YV91cmkpIHtcclxuICAgICAgICAgIGltYWdlc1tpbmRleF0gPSBkYXRhX3VyaTtcclxuICAgICAgICAgIGlmKGluZGV4IDwgKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVQcm9ncmVzcykpIHtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4KzEpICogMTAwKSAvIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgIHZtLm9uQ2FwdHVyZVByb2dyZXNzKHtzcmM6IGRhdGFfdXJpLHByb2dyZXNzOiBwcm9ncmVzc30pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlQ29tcGxldGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5vbkNhcHR1cmVDb21wbGV0ZSh7c3JjOiBpbWFnZXN9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1DYXB0dXJlKCkge1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmNvdW50ZG93bikpIHtcclxuICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcclxuICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYoY291bnRkb3duVGltZXIgIT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgdm0uY291bnRlciA9IDM7XHJcbiAgICAgICAgICBjb3VudGRvd25UaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0uY291bnRlciA9IHZtLmNvdW50ZXIgLSAxO1xyXG4gICAgICAgICAgICBpZih2bS5jb3VudGVyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgaWYoY291bnRkb3duVGltZXIpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY291bnRkb3duVGltZXIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCAxMDAwLCAzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtT24oKSB7XHJcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PZmYoKSB7XHJcbiAgICAgICAgZGVzdHJveSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG4gIH1cclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
